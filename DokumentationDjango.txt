-- DJANGO INSTALLATION --
! make sure python and its pip are in windows system variable

pip install django

-- CREATE PROJECT --
django-admin startproject backend
! in this folder you find the manage.py script which starts the server
! as well as the "backend" folder where the python files are stored

-- CREATE HTML-PAGE AND DISPLAY IT --
! create a folder "frontend" in the folder structure where the manage.py
! script and the "backend" folder is stored. In this you can create a html-files
! named index.html e.g.

<html>
  <body>
    <p>Hello World!</p>   
  </body>
</html>

! the backend now needs to know where the frontend is located. In the settings.py
! file in the "backend" folder you find the TEMPLATES entry with an empty 'DIRS': []
! -> in the square brackets add
os.path.join(BASE_DIR, 'frontend')
! now the backend knows where your html templates are located.

! the backend now needs to know how to handle client requests.
! in the "backend" folder create a python file views.py with the content 

from django.shortcuts import render
from django.conf import settings
from django.http import HttpResponse,Http404

def index (request):
	return render(request, 'index.html')
	
! the backend now knows what to response if the index method is called 
! (namely to render index.html).

! the URLs which define which view is loaded are defined in the backends urls.py
! here we first need to import the views folder 
from . import views

! and then add the index url which sends the request to the index method of views.py
url(r'^index/', views.index),

-- RUN SERVER --
! open cmd and navigate to the folder where the manage.py is located. Call
python manage.py runserver
! to start the server and open localhost:8000/index to view the created html page!
! to be able to open the index page without calling /index but only the domain change 
url(r'^index/', views.index),
! to 
url(r'^$', views.index),
! now localhost:8000 will render the index.html page

! this can be shortened with a .bat file like startServer.bat which includes 
start "" http://127.0.0.1:8000/index
python manage.py runserver

-- FILE UPLOAD -- 
! In the index.html file of the frontend, replace the current code with

<html>
  <body>
    <form ref='uploadForm' 
      id='uploadForm' 
      action='http://localhost:8000/upload/' 
      method='post' 
      encType="multipart/form-data">{% csrf_token %}
        <input type="file" name="myFile" /> 
        <input type="hidden" name="_csrf" value="<your_csrf_token>" />
        <input type='submit' value='Upload!' />
    </form>     
  </body>
</html>

! A form can take user input parameters and send a post request to perform something.
! The "action" which should be done is defined in the URL 'http://localhost:8000/upload/'
! which we'll create later. 'encType="multipart/form-data"' defines that the post 
! request will contain data (which should be stored on the server).
! csrf tokens are for security reasons (link). 
! The three input buttons types are:
! file -> button to open explorer to open file
! hidden -> not displayed csrf key sended for security 
! submit -> perform the post request

! to create a valid link for the form we need to insert the URL in the backends urls.py
url(r'^upload/', views.upload  ),

! and create the respective 'upload' methods in the views.py
def upload(request):
	doc_to_save = request.FILES['myFile']
	filename = doc_to_save._get_name()
	fd = open(settings.BASE_DIR+'\\uploads\\'+str(filename),'wb')
        for chunk in doc_to_save.chunks():
            fd.write(chunk)
        fd.close()
	return files(request)

! l2: get the file attached to the request (named 'myFile' in the html code)
! l3: get the name of the file
! l4: (for this line we need to create a new folder called "uploads" in the folder where 
!     the manage.py file is located -> in this folder the uploaded files are stored)
!     In the newly created folder create a new file with the same name as the uploaded 
!     file and open it with write acess
! l5+:write the content of the post request file into the new file and close 

-- LIST ALL UPLOADED FILES --
! create new html file in the frontend called filelist.html containing

<html>
  <body>
    <ol>
    {% for file in files %}
      <li>{{file}}</li>
    {% endfor %}
    </ol>  
  </body>
</html>

! the code in {} is django syntax to create html content without hard coding.
! we will use this now in python, first create the URL to view all uploaded files:

url(r'^files/', views.files  ),

! next we define the "files" method in views.py:

def files(request):
	path=settings.BASE_DIR+'\\uploads\\'  # insert the path to your directory   
	file_list =os.listdir(path) 
	context = {'files': file_list,}
	return render(request, 'filelist.html', context)

! (this needs the adding of "import os" in the top of the file)
! l2: build the path to the folder where the uploads are stored
! l3: get all files in the folder using the os library
! l4: build the 'files' variable used in the html with all the files listed in file_list
! l5: render the html file but with the context (the files) as additional parameter

-- RETURN UPLOADED FILE TO USER --
! we now want that a user can acess his uploaded file. First create a URL:

url(r'^getFile/(?P<path>.*)$', views.getFile),

! while in (?P<path>.*)$ "path" is a variable in which the passed filename is 
! stored and passed to the views method as additional parameter (see below)
! (e.g. /getFile/test.json -> path = "test.json"

! next we define the "getFile" method in views.py:

def getFile(request, path):
	path_upload=settings.BASE_DIR+'\\uploads\\'  # insert the path to your directory   
	file_path = os.path.join(path_upload, path)
	if os.path.exists(file_path):

                json_data = open(file_path)
                data = json.load(json_data) 
                json_data.close()
                return JsonResponse(data)

	raise Http404

! (this needs the adding of "import json" and "from django.http import JsonResponse"
! in the top of the file)
! l1: see the addidional parameter from the url (path)
! l2: build the path to the folder where the uploads are stored
! l3: join this path with the given filename
! l4: if this file exists on the servers file storage
! l5: open the file
! l6: parse the json data
! l7: close the file
! l8: and return a JsonResponse (JSON will be displayed in the Browser)
! l9: if file does not exist raise Http404 file not found error


